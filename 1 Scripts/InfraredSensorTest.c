#pragma config(Sensor, in1, infraC, sensorReflection)
#pragma config(Sensor, in2, InfraC2, sensorAnalog)
#pragma config(Sensor, dgtl1, RedLED, sensorDigitalOut)
#pragma config(Sensor, dgtl4, buttonToMove, sensorDigitalIn)
#pragma config(Sensor, dgtl6, SonarIn, sensorSONAR_cm)
#pragma config(Sensor, dgtl11, buttonToTurn, sensorDigitalIn)
#pragma config(Motor, port1, leftMotor, tmotorVex393_HBridge, openLoop, reversed)
#pragma config(Motor, port10, rightMotor, tmotorVex393_HBridge, openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

/*************************************************************************
 *
 *
 * Electrical Test 01: IR Sensor Test
 *
 * Breadboard Connected To: Digital Port 1 (LED Light Signal)
 *                          Analog Port 7 (PhotoTransistor)
 *
 *
 *************************************************************************/

// Threshold of value read from phototransistor circuit.
const int thresholdSensorValue = 1000; // My Idea --> if robot finds a value greater than the thresh

enum programState // States in our Test
{
    LookingForSignal,
    FoundSignal,
    MoveToTheSignal
};

int motorSpeed = 50; // Motor Speed
int OFF = 0;         // Light Source ON
int ON = 1;          // Light Source OFF


void SourceDetectionSignal ()
{
    SensorValue(RedLED) = ON;
    wait1Msec(350);
    SensorValue(RedLED) = OFF;
    wait1Msec(350);
    SensorValue(RedLED) = ON;
    wait1Msec(350);
    SensorValue(RedLED) = OFF;
}


task main()
{
    programState currState = LookingForSignal;
    SourceDetectionSignal();
    while (1 == 1)
    {
        if (SensorValue[buttonToMove] == 0)
        {
            while (1 == 1)
            {
                switch (currState)
                {
                case (LookingForSignal):
                    SensorValue(RedLED) = OFF;
                    while (SensorValue[SonarIn]>10)
                    {
                        // while ((SensorValue(SonarIn)<0)&&(SensorValue(SonarIn)>10)) {
                        motor[leftMotor] = motorSpeed;
                        motor[rightMotor] = motorSpeed+5;
                        wait1Msec(5);
                    }
                    if (SensorValue[infraC] > thresholdSensorValue)
                    {
                        currState = FoundSignal;
                        SensorValue(RedLED) = ON;
                        break;
                    }

                case (FoundSignal):
                    SensorValue(RedLED) = ON;
                default: // We should never be in this state.
                }
                if (SensorValue[SonarIn] == -1)
                {
                    motor[leftMotor] = 0;
                    motor[rightMotor] = 0;
                    break;
                }
            }
        }
    }
}
