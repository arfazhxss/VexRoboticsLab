#pragma config(Sensor, in1,    infraC,         sensorReflection)
#pragma config(Sensor, in2,    InfraC2,        sensorAnalog)
#pragma config(Sensor, dgtl1,  RedLED,         sensorDigitalOut)
#pragma config(Sensor, dgtl4,  buttonToMove,   sensorDigitalIn)
#pragma config(Sensor, dgtl6,  SonarIn,        sensorSONAR_cm)
#pragma config(Sensor, dgtl11, buttonToTurn,   sensorDigitalIn)
#pragma config(Motor,  port1,           leftMotor,     tmotorVex393_HBridge, openLoop, reversed)
#pragma config(Motor,  port10,          rightMotor,    tmotorVex393_HBridge, openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

/*************************************************************************
 *
 *
 * Electrical Test 01: IR Sensor Test
 *
 * Breadboard Connected To: Digital Port 1 (LED Light Signal)
 *                          Analog Port 7 (PhotoTransistor)
 *
 *
 *************************************************************************/

// Threshold of value read from phototransistor circuit.
const int IR_SENSOR_THRESHOLD = 1000;

enum programState
{
  LookingForSignal = 0,
  FoundSignal = 1,
  MoveToTheSignal = 2
};

int motorSpeed = 25;
int OFF = 0;                // Light Source ON
int ON = 1;                 // Light Source OFF

/*
void SourceDetectionSignal ()
{
    SensorValue(RedLED) = OFF;
    wait1Msec(1000);
    SensorValue(RedLED) = ON;
    wait1Msec(1000);
    SensorValue(RedLED) = OFF;
    wait1Msec(1000);
    SensorValue(RedLED) = ON;
    wait1Msec(1000);
    SensorValue(RedLED) = OFF;
}
*/

task main() {
    programState currState = LookingForSignal;
    //SourceDetectionSignal();
    if (SensorValue[buttonToMove] == 0) {
        while (1==1) {
            switch (currState) {
                case (LookingForSignal):
                    SensorValue(RedLED) = ON;
                    while (SensorValue(infraC)<IR_SENSOR_THRESHOLD) {
                    //while ((SensorValue(SonarIn)<0)&&(SensorValue(SonarIn)>10)) {
                        motor[leftMotor] = motorSpeed;
                        motor[rightMotor] = motorSpeed;
                        wait1Msec(10);
                        if (SensorValue[infraC] > IR_SENSOR_THRESHOLD) {
                            currState = FoundSignal;
                            SensorValue(RedLED) = OFF;
                            break;
                        }
                    }

                case (FoundSignal):
                    SensorValue(RedLED) = ON;
                    motor[leftMotor] = 75;
                    motor[rightMotor] = 80;
                    if (SensorValue[buttonToTurn] == 0) {motor[leftMotor]=0;}
                    if (SensorValue(infraC) < IR_SENSOR_THRESHOLD) {currState = LookingForSignal;}
                    break;
                default: // We should never be in this state.
            }
        }
    }
}
