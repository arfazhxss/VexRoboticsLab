#pragma config(Sensor, in1,    InfraCollector, sensorReflection)
#pragma config(Sensor, dgtl1,  RedLED,         sensorDigitalOut)
#pragma config(Sensor, dgtl4,  buttonToMove,   sensorDigitalIn)
#pragma config(Sensor, dgtl11, buttonToTurn,   sensorDigitalIn)
#pragma config(Motor,  port1,           leftMotor,     tmotorVex393_HBridge, openLoop, reversed)
#pragma config(Motor,  port10,          rightMotor,    tmotorVex393_HBridge, openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

/*************************************************************************
 *
 *
 * Electrical Test 01: IR Sensor Test
 *
 * Breadboard Connected To: Digital Port 1 (LED Light Signal)
 *                          Analog Port 7 (PhotoTransistor)
 *
 *
 *************************************************************************/

// Threshold of value read from phototransistor circuit.
const int IR_SENSOR_THRESHOLD = 1000;

enum programState
{
  LookingForSignal = 0,
  FoundSignal = 1
};

const int motorSpeed = 25;
const int OFF = 0;                // Light Source ON
const int ON = 1;                 // Light Source OFF
/*
void SourceDetectionSignal ()
{
    SensorValue(RedLED) = OFF;
    wait1Msec(500);
    SensorValue(RedLED) = ON;
    wait1Msec(500);
    SensorValue(RedLED) = OFF;
    wait1Msec(500);
    SensorValue(RedLED) = ON;
    wait1Msec(500);
    SensorValue(RedLED) = OFF;
}
*/
/*
void moveForward() {

    motor[leftMotor] = motorSpeed;
    motor[rightMotor] = motorSpeed+5;                // calibrating with both motor speed
    wait1Msec(2500);                                 // may differ by weight and circumstance, subject to change
                               // legacy test end

}
*/

task main() {
    programState currState = LookingForSignal;
    //SourceDetectionSignal();

    while (1==1) {
    	if (SensorValue[buttonToMove] == 0) {
        switch (currState) {
            case (LookingForSignal):
                motor[leftMotor] = motorSpeed;
                motor[rightMotor] = motorSpeed;
                wait1Msec(50);
                SensorValue(RedLED) = OFF;
								//if (SensorValue[buttonToTurn] == 0) {motor[leftMotor]=0;motor[rightMotor]=0;}
                if (SensorValue[InfraCollector] < IR_SENSOR_THRESHOLD) {
                	currState = FoundSignal;
                	SensorValue(RedLED) = ON;
                }
                break;
            case (FoundSignal):
                SensorValue(RedLED) = ON;
                motor[leftMotor] = 75;
                motor[rightMotor] = 80;
                if (SensorValue[buttonToTurn] == 0) {motor[leftMotor]=0;}
                if (SensorValue(InfraCollector) > IR_SENSOR_THRESHOLD) {currState = LookingForSignal;}
                break;
            default: // We should never be in this state.
        }
      }
    }
}
